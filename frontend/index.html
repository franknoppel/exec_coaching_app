<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>{{ title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/app.css" />
</head>
<body>
  <main>
    <h1>Executive Coaching Dashboard</h1>

    <section>
      <h2>Coach Profile</h2>
      <form id="profileForm">
        <div class="row">
          <input name="name" placeholder="Your name" required />
          <input name="bio" placeholder="Short bio" />
          <input name="photo" type="file" accept="image/*" />
          <button type="submit">Save Profile</button>
        </div>
        <div id="profileResult"></div>
      </form>
      <div id="coachPhoto"></div>
    </section>

    <section>
      <h2>Coachees</h2>
      <div id="coachees"></div>
      <form id="addForm">
        <input name="name" placeholder="Add coacheeâ€¦" required />
        <button type="submit">Add</button>
      </form>
    </section>
  </main>

  <script>
    async function loadCoachees() {
      const res = await fetch("/api/coachees");
      const data = await res.json();
      const el = document.getElementById("coachees");
      el.innerHTML = (data.items || []).map(c => `
        <div class="coachee">
          <span>${c.name}</span>
          <div class="actions">
            <a href="#" data-id="${c.id}" class="sessions">Sessions</a>
            <button data-id="${c.id}" class="remove">Remove</button>
          </div>
        </div>
      `).join("") || "<p>No coachees yet.</p>";
    }

    document.addEventListener("click", async (e) => {
      if (e.target.classList.contains("remove")) {
        e.preventDefault();
        const id = e.target.getAttribute("data-id");
        await fetch(`/api/coachees/${id}`, { method: "DELETE" });
        loadCoachees();
      }
      if (e.target.classList.contains("sessions")) {
        e.preventDefault();
        const id = e.target.getAttribute("data-id");
        const res = await fetch(`/api/coachees/${id}/sessions`);
        const data = await res.json();
        alert(`Sessions for coachee ${id}:\n` + JSON.stringify(data.items, null, 2));
      }
    });

    document.getElementById("addForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);
      await fetch("/api/coachees?name=" + encodeURIComponent(form.get("name")), { method: "POST" });
      e.target.reset();
      loadCoachees();
    });

    document.getElementById("profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch("/api/coach/profile", { method: "POST", body: formData });
      const data = await res.json();
      document.getElementById("profileResult").textContent = "Saved!";
      if (data.photo_url) {
        document.getElementById("coachPhoto").innerHTML =
          `<img src="${data.photo_url}" alt="Coach photo" style="max-width:200px;border-radius:12px;margin-top:8px;" />`;
      }
    });

    loadCoachees();
  </script>
</body>
</html>
